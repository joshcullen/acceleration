---
title: "Estimation of latent behavioral states and relationships with environmental covariates in giant armadillos (*Priodontes maximus*)"
author: "Josh Cullen"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document: 
    fig_caption: yes
    latex_engine: xelatex
header-includes:
  - \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      fig.width=6,
                      fig.height = 4,
                      fig.align = 'center',
                      fig.pos = 'H')
```

# Background

While there has been an increased effort to understand the movement and spatial ecology of giant armadillos within the Brazilian Pantanal, quantitative measures of latent behavioral states and their relationships with environmental covariates have not yet been evaluated. The estimation of latent behavioral states from animal telemetry data is useful to elucidate what behaviors individuals are performing over time and how they correspond with different environmental features over space and time. Latent behavioral states are often estimated by evaluating the measures of step lengths and turning angles of a set of tracks using hidden Markov models (HMMs), although there are some limitations to this approach. A recent method developed by Valle et al. (in review) uses a non-parametric Bayesian mixture model with a penalized prior to estimate the optimal number of behavioral states, the associated state-dependent distributions for each state, and the state estimates for each observation of the tracks. These can be evaluated using any set of data streams recorded by the tag or metrics derived from the track itself (e.g., step lengths, turning angles, accelerometer data). This mixture model was used to estimate the latent behavioral states from giant armadillos to assess how this species interacts with its environment in the Brazilian Pantanal.


# Methods

## Data prep
Movement data were available for 7 individuals (blanca, emanuel, gala, mafalda, mazeboti, sara, tex) from 2019 â€“ 2020. A sample size of N = 18,433 total GPS locations and N = 140,162 total activity count measurements were analyzed from all 7 IDs. The tags recorded activity counts (i.e., the changes in the x, y, or z axes over a 5 min duration) and GPS positions, which were used to calculate step lengths and turning angles. These movement data were heavily filtered to remove error-prone measurements that could bias the results. This included the removal of aberrant locations due to low satellite coverage ($\leq$ 4 satellites), step lengths that were larger than possible ($>$ 800 m; 99th quantile), and when activity counts were equal to zero. Since activity counts were recorded at 5 min intervals and GPS locations were recorded at 7 min intervals, activity counts were only retained when sampled at a time $\leq$ 1 min different from the GPS tag. Additionally, GPS positions were filtered to only include observations sampled at 7 $\pm$ 1 min. Step lengths were then converted to speed by dividing by the time step (i.e., 7 min). After all filtering steps, a total of 9,948 observations were retained for further analysis. Next, speed, turning angles, and activity counts were discretized into bins for analysis by the non-parametric Bayesian mixture model.\newline


Activity counts ranged from 1 to 300 and were discretized into 6 bins of equal width. Speed ranged from 0 to 2.13 m/s and was discretized into 7 bins. Since 99% of speed observations were recorded below 1 m/s, 6 bins of equal width were used to discretize speed from 0 to 1 m/s. All observations greater than 1 m/s (up to 2.13 m/s) were assigned to the 7th bin. Turning angles ranged from $-\pi$ to $\pi$ radians and were discretized into 10 bins of equal width. Plots of continuous and discretized distributions are shown below. Additionally a plot of filtered tracks for each ID is also included for spatial context.

\  
\  


```{r}
library(tidyverse)
library(lubridate)
library(raster)
library(viridis)
library(sf)
library(ks)
library(cowplot)

dat<- read.csv('Giant Armadillo state estimates.csv', as.is = T)
dat$date<- as_datetime(dat$date, tz = "UTC")
dat<-  dat %>% 
  rename(x = easting, y = northing) %>% 
  mutate(across(c('z.map','z.post.thresh','z.post.max'), factor,
                levels = c("Slow-Turn","Slow-Unif","Exploratory","Transit","Unclassified"))
  )

dat$month<- month.abb[month(dat$date)]
dat$month<- factor(dat$month, levels = month.abb[c(5:12,1)])
dat$season<- ifelse(dat$month %in% c(month.abb[3:5]), "Fall",
                    ifelse(dat$month %in% c(month.abb[6:8]), "Winter",
                           ifelse(dat$month %in% c(month.abb[9:11]), "Spring", "Summer")))
dat$season<- factor(dat$season, levels = c("Fall","Winter","Spring","Summer"))
```

```{r track_map, fig.cap='Tracks of retained GPS positions for all 7 giant armadillos.'}
ggplot(data = dat, aes(x, y)) +
  geom_path(aes(group = id, color = id)) + 
  geom_point(aes(color = id), alpha = 0.4) +
  scale_color_brewer("", palette = "Dark2") +
  labs(x = "Easting", y = "Northing") +
  theme_bw() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 12),
        panel.grid = element_blank())
```

```{r density_plots, fig.cap='Density plots of speed, turning angles, and activity counts.'}

#discretize activity counts
act.bin.lims=seq(from=0,to=300,by=50)
act.bin.lims[length(act.bin.lims)]=300.1

#discretize speed
sl.bin.lims=c(seq(from=0,to=60,by=10),max(dat$sl2)+1)

#discretize turning angles
ta.bin.lims=seq(from=-pi,to=pi,length.out=11)
ta.bin.lims[length(ta.bin.lims)]=3.142 #to include observation if exactly equal to pi


#Viz discretized distrib
dat_disc.df<- dat %>% 
  dplyr::select(act.cat, sl.cat, ta.cat) %>% 
  pivot_longer(cols = c(act.cat, sl.cat, ta.cat), names_to = "var", values_to = "value")

param.prop<- dat_disc.df %>%
  group_by(var, value) %>%
  summarise(n=n()) %>%
  drop_na() %>% 
  mutate(prop=n/sum(n)) %>%
  ungroup() %>%   #if don't ungroup after grouping, ggforce won't work
  data.frame()

param.prop[1:6, "value"]<- ((diff(act.bin.lims)/2) + act.bin.lims[1:6])
param.prop[7:13, "value"]<- ((diff(sl.bin.lims)/2) + sl.bin.lims[1:7])
param.prop[14:23, "value"]<- (diff(ta.bin.lims)/2) + ta.bin.lims[1:10]





## Speed
ggplot(data = dat, aes(sl2/60)) +
  geom_density(fill = "lightblue") +
  geom_vline(data = data.frame(lims = sl.bin.lims/60), aes(xintercept = lims), 
             linetype = "dashed") +
  labs(x = "Speed (m/s)", y = "Density") +
  theme_bw() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 12),
        panel.grid = element_blank())

ggplot(data = param.prop %>% filter(var == "sl.cat"), aes(value/60, prop)) +
  geom_bar(stat = "identity", width = diff(sl.bin.lims/60),
           fill = "lightblue", color = "black") +
  labs(x = "Step Length (m/s)", y = "Proportion") +
  theme_bw() +
  theme(panel.grid = element_blank(), axis.title = element_text(size = 16),
        axis.text = element_text(size = 12))


## Turning Angle
ggplot(data = dat, aes(ta2)) +
  geom_density(fill = "indianred") +
  geom_vline(data = data.frame(lims = ta.bin.lims), aes(xintercept = lims), 
             linetype = "dashed") +
  labs(x = "Turning Angle (rad)", y = "Density") +
  theme_bw() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 12),
        panel.grid = element_blank())

ggplot(data = param.prop %>% filter(var == "ta.cat"), aes(value, prop)) +
  geom_bar(stat = "identity", width = diff(ta.bin.lims),
           fill = "indianred", color = "black") +
  labs(x = "Turning Angle (rad)", y = "Proportion") +
  theme_bw() +
  theme(panel.grid = element_blank(), axis.title = element_text(size = 16),
        axis.text = element_text(size = 12))


## Activity Counts
ggplot(data = dat, aes(act.count)) +
  geom_density(fill = "cadetblue") +
  geom_vline(data = data.frame(lims = act.bin.lims), aes(xintercept = lims), 
             linetype = "dashed") +
  labs(x = "Activity Count", y = "Density") +
  theme_bw() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 12),
        panel.grid = element_blank())

ggplot(data = param.prop %>% filter(var == "act.cat"), aes(value, prop)) +
  geom_bar(stat = "identity", width = diff(act.bin.lims),
           fill = "cadetblue", color = "black") +
  labs(x = "Activity Counts", y = "Proportion") +
  theme_bw() +
  theme(panel.grid = element_blank(), axis.title = element_text(size = 16),
        axis.text = element_text(size = 12))
  
```


## Clustering observations into latent behavioral states
Filtered data were analyzed by a non-parametric Bayesian mixture model using the `cluster_obs()` function in the *bayesmove* package in R. This model clusters observations pooled across all individual tracks into a finite number of latent behavioral states. Through the use of a penalizing prior, we can set the maximum number of possible states and the model will prefer to assign observations to a fewer number of clusters/states. This clustering was performed using the bin labels for all three data streams (i.e., activity counts, speed, and turning angles) from all 9,948 observations where the maximum number of clusters was set equal to 10. We ran a Gibbs sampler using Markov chain Monte Carlo (MCMC) with 20,000 iterations where the first 10,000 iterations were treated as the burn-in and the second 10,000 iterations constituted the posterior.\newline


The number of latent states was identified by inspecting the average proportion of observations assigned to each cluster/state as well as the state-dependent distributions of activity counts, speed, and turning angles. Once the states were defined, the posterior estimates of state assignments for each observation were evaluated. To ensure that there was high certainty with the assigned behavioral state for a given observation, $\geq$ 75% of all posterior estimates needed to belong to a single state. If none of the states for a given observation fell above this threshold, the observation was labeled as "Unclassified".


## Extraction of environmental covariates
To relate the estimated behavioral states to giant armadillo habitat, environmental covariates were extracted at each location. This included land use/land cover (LU/LC) as well as normalized difference water index (NDWI), a measure of the wetness of a location. The LU/LC data was obtained from ICAS and consisted of four land classes: Forest, Closed Savanna, Open Savanna, and Floodable. These data were stored at a 30 m spatial resolution with as a static variable (i.e., it did not change over time). NDWI was derived from Landsat 8 imagery for the time period for which the giant armadillos were transmitting (May 2019 to January 2020). These were downloaded at a spatial resolution of 30 m, but were aggregated to an average seasonal layer to minimize data missingness due cloud cover.\newline


Environmental covariates were extracted using a 30 m buffer around each GPS position. This was performed to account for possible location error from the tag and capture any local heterogeneity in the habitat for a given location. Since LU/LC is a discrete variable, the proportion of land classes was calculated for each position, whereas the mean NDWI was calculated since it is a continuous variable.

```{r map_covars}

#LULC
lulc<- raster('cheiann_UTM1.tif')
names(lulc)<- 'lulc'

#crop raster closer to armadillo relocs
lulc<- crop(lulc, extent(dat %>% 
                           summarize(xmin = min(x) - 5000,
                                     xmax = max(x) + 5000,
                                     ymin = min(y) - 5000,
                                     ymax = max(y) + 5000) %>% 
                           unlist()))
lulc.df<- as.data.frame(lulc, xy = TRUE)


#NDWI
setwd("~/Documents/Snail Kite Project/Data/R Scripts/ValleLabUF/resist_avg")

ndwi<- brick('GiantArm_ndwi_season.grd')
ndwi<- resample(ndwi, lulc, method = "bilinear")
# compareRaster(lulc, ndwi)

ndwi.df<- as.data.frame(ndwi, xy = T)
ndwi.df2<- pivot_longer(ndwi.df, cols = -c(x,y), names_to = "season", values_to = "ndwi")
ndwi.df2$season<- factor(ndwi.df2$season, levels = names(ndwi))

setwd("~/Documents/Snail Kite Project/Data/R Scripts/acceleration")


#map LU/LC
ggplot() +
  geom_raster(data = lulc.df, aes(x, y, fill = factor(lulc))) +
  scale_fill_manual("LU/LC", values = c("darkgreen","burlywood4","darkolivegreen3",
                                        "lightskyblue1"),
                    na.value = "transparent",
                    labels = c("Forest", "Closed Savanna", "Open Savanna", "Floodable","")) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x="Easting", y="Northing") +
  theme_bw() +
  coord_equal() +
  theme(legend.position = "right",
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 10),
        legend.title = element_text(size = 14),
        legend.text = element_text(size = 12))

#map NDWI
ggplot() +
  geom_raster(data = ndwi.df2, aes(x, y, fill = ndwi)) +
  scale_fill_distiller("NDWI", palette = "RdBu", na.value = "transparent", limits = c(-1,1),
                       direction = 1) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x="Easting", y="Northing") +
  theme_bw() +
  coord_equal() +
  theme(legend.position = "right",
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 10),
        legend.title = element_text(size = 14),
        legend.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold")) +
  facet_wrap(~ season)
```


## Comparison of habitat use among behavioral states

To quantify the differences in relationships with LU/LC and NDWI among behavioral states, logistic regressions were performed to evaluate pairwise differences. These logistic regressions included the proportion of each land class, NDWI, and armadillo ID as covariates. Closed Savanna and blanca were treated as reference classes (part of intercept). For quick visualization of the model's estimates, coefficients for each of the remaining land classes (Forest, Open Savanna, Floodable) and NDWI were plotted as odds ratios with 95% confidence intervals. This was performed for each pairwise comparison of states.


# Results

## Estimation of latent behavioral states

The mixture model suggested that four states were optimal based on the average number of observations assigned to each state (top four accounted for 98% of all observations) and an inspection of the state-dependent distributions. By using a threshold of 75% posterior samples assigned to a single state for a given observation, 38% of the 9,948 observations were unclassified.

```{r behav_states, fig.width=7, fig.height=5, fig.cap='State-dependent distributions for each of the four retained states from the mixture model. Bin numbers reflect discretized variables from previous figures.'}

behav.res<- read.csv('Giant Armadillo behavior distribs.csv', as.is = T)
behav.res$behav<- factor(behav.res$behav, levels = c("Slow-Turn","Slow-Unif","Exploratory",
                                                     "Transit"))

# Plot state-dependent distributions 
ggplot(behav.res, aes(x = bin, y = prop, fill = behav)) +
  geom_bar(stat = 'identity', color = "black") +
  labs(x = "\nBin", y = "Proportion\n") +
  theme_bw() +
  theme(axis.title = element_text(size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x.bottom = element_text(size = 12),
        strip.text.y = element_text(size = 10),
        strip.text.x = element_text(size = 14, face = "bold")) +
  scale_fill_viridis_d(option = 'inferno', guide = FALSE) +
  scale_y_continuous(breaks = c(0.00, 0.50, 1.00)) +
  scale_x_continuous(breaks = 1:10) +
  facet_grid(behav ~ var, scales = "free_x")
```


Given my limited background in the behavioral ecology of giant armadillos, behavioral states are given preliminary names that can be later modified. For now, they are identified as 'Slow-Turn', 'Slow-Uniform', 'Exploratory', and 'Transit'. The 'Slow-Turn' state is characterized by relatively lower activity counts, low speed, and high turning angles (near $-\pi/\pi$ radians). The 'Slow-Uniform' state is nearly identical to the 'Slow-Turn' state for distributions of activity counts and speed, but has a more uniform distribution of turning angles. The 'Exploratory' state is characterized by higher activity counts, greater speed, and lower turning angles (near 0 radians) than either the 'Slow-Turn' or 'Slow-Uniform' states. Lastly, the 'Transit' state exhibits the greatest activity counts, greatest speeds, and lowest turning angles.\newline


A quick inspection of the plotted behavioral states provides an idea of their spatial configuration for each individual:

```{r state_map, fig.width=14, fig.height=14, fig.cap='Mapped behavioral states from the mixture model for each armadillo'}

#map states by ID
ggplot(dat, aes(x, y, color = z.post.thresh)) +
  scale_color_manual("", values = c(viridis::viridis(4, option = "inferno"), "grey")) +
  geom_path(aes(group = id), color = "grey80", size = 0.5) +
  geom_point(size = 2) +
  labs(x = "Easting", y = "Northing") +
  theme_bw() +
  theme(axis.title = element_text(size = 30),
        axis.text = element_text(size = 15),
        legend.text = element_text(size = 24),
        panel.grid = element_blank(),
        strip.text = element_text(size = 24, face = "bold")) +
  guides(color = guide_legend(override.aes = list(size=5))) +
  facet_wrap(~ id, scales = "free", ncol = 2)

```


## Exploratory data analysis

Below is an example of a track segment where LU/LC and NDWI would be extracted within 30 m of a given observation. Based on these values, as well as other characteristics of the data, we can summarize the data a few different ways to explore any obvious underlying spatiotemporal patterns for the behavioral states.

```{r covar_extr_ex, dev='png', dpi=300, fig.cap="Subset of blanca's first 20 observations. State estimates are color coded over LU/LC and NDWI and 30 m buffers used to extract proportions of land classes and mean NDWI are shown for each position."}

tmp<- dat[1:20,]
x.range<- range(tmp$x)

y.range<- range(tmp$y)

# Buffer circles by 30 m
dat_sf <- st_as_sf(tmp, coords = c("x", "y"), crs = 32721)
tmp.buff<- st_buffer(dat_sf, dist = 30)

ggplot() +
  geom_raster(data = lulc.df, aes(x, y, fill = factor(lulc))) +
  scale_fill_manual("LU/LC", values = c("darkgreen","burlywood4","darkolivegreen3",
                                        "lightskyblue1"),
                    na.value = "transparent",
                    labels = c("Forest", "Closed Savanna", "Open Savanna", "Floodable","")) +
  geom_sf(data = tmp.buff, fill = "transparent", color = "black") +
  coord_sf() +
  geom_path(data = tmp, aes(x, y, group = id), color = "grey20", size = 0.5) +
  geom_point(data = tmp, aes(x, y, color = z.post.thresh), size = 2, na.rm = T) +
  scale_color_manual("", values = c(viridis(n=4, option = 'inferno')[1:3], "grey")) +
  scale_x_continuous(expand = c(0,0), limits = c(x.range[1]-50, x.range[2]+50)) +
  scale_y_continuous(expand = c(0,0), limits = c(y.range[1]-50, y.range[2]+50)) +
  labs(x="Longitude", y="Latitude") +
  theme_bw()



ggplot() +
  geom_raster(data = ndwi.df2[ndwi.df2$season == "Winter",], aes(x, y, fill = ndwi)) +
  scale_fill_distiller("NDWI", palette = "RdBu", na.value = "transparent", limits = c(-1,1),
                      direction = 1) +
  geom_sf(data = tmp.buff, fill = "transparent", color = "black") +
  coord_sf() +
  geom_path(data = tmp, aes(x, y, group = id), color = "grey20", size = 0.5) +
  geom_point(data = tmp, aes(x, y, color = z.post.thresh), size = 2, na.rm = T) +
  scale_color_manual("", values = c(viridis(n=4, option = 'inferno')[1:3], "grey")) +
  scale_x_continuous(expand = c(0,0), limits = c(x.range[1]-50, x.range[2]+50)) +
  scale_y_continuous(expand = c(0,0), limits = c(y.range[1]-50, y.range[2]+50)) +
  labs(x="Longitude", y="Latitude") +
  theme_bw()
```


I will be summarizing the behavioral states by ID, season, and hour of day. An overview of the activity budgets for each ID shows that there is very little difference among IDs, where Exploratory and Slow-Uniform states are the most common and occur at approximately the same frequency (except in blanca). The Slow-Turn state is the next most common, followed by the Transit state. While not informative, Unclassified observations typically comprise the greatest proportion of observations. These patterns are also observed when visualizing activity budgets by season. However, it appears that Slow-Uniform and Exploratory states occur at the same frequency during the fall and spring, but the Slow-Uniform state occurs more often during winter and summer. An assessment of activity budgets broken down by hour of the day shows greatest activity from midnight to 4 am. However, there does appear to be some activity occurring after sunrise (i.e., 6:30 to 10 am), which is uncommon since this is a nocturnal species. By explicitly evaluating the proportion of observations attributed to each state per hour, there does not appear to be a discernible pattern. State proportions appear to be relatively constant and exhibited at proportions similar to overall frequencies in the data.


```{r covar_extr}
# Proportions LULC w/in 30 m buffer
extr.lulc<- extract(lulc, dat[,c('x','y')], buffer = 30)  #extract lulc w/in 30 m buffer
extr.lulc2<- map(extr.lulc, ~{prop.table(table(.))}) %>%  #convert to proportions lulc
  map(., ~{
    mat<- matrix(0, 1, 4)
    mat[1, as.numeric(names(.x))]<- .x
    
    df<- data.frame(mat)
    df
    }) %>% 
  bind_rows()
names(extr.lulc2)<- c("Forest", "Closed_Savanna", "Open_Savanna", "Floodable")


# Mean NDWI w/in 30 m buffer
extr.ndwi<- rep(NA, nrow(dat))
seasons<- names(ndwi)
for (i in 1:nlayers(ndwi)) {
  ind<- which(dat$season == seasons[i])
  extr.ndwi[ind]<- extract(ndwi[[i]], dat[ind, c('x','y')], buffer = 30, fun = mean)
}


# Merge extracted covariates to dat
dat2<- cbind(dat, extr.lulc2, ndwi = extr.ndwi)

```

```{r state_summ1, fig.width=8, fig.cap='Summary of behavioral states by ID, season, and hour of day.'}

## Proportion of behavior by ID

df.ID<- dat2 %>% 
  group_by(id, z.post.thresh) %>% 
  summarize(n = n()) %>% 
  mutate(freq = n / sum(n))

ggplot(df.ID, aes(z.post.thresh, freq, fill = z.post.thresh)) +
  geom_col(color = "black") +
  scale_fill_manual("", values = c(viridis(n=4, option = 'inferno'), "grey"),
                    guide = guide_legend(reverse = TRUE)) +
  theme_bw() +
  labs(x = "", y = "Proportion of Observations") +
  facet_wrap(~ id) +
  coord_flip() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold"),
        legend.text = element_text(size = 10))



## Proportion of behavior by season

df.season<- dat2 %>% 
  group_by(season, z.post.thresh) %>% 
  summarize(n = n()) %>% 
  mutate(freq = n / sum(n))

ggplot(df.season, aes(z.post.thresh, freq, fill = z.post.thresh)) +
  geom_col(color = "black") +
  scale_fill_manual("", values = c(viridis(n=4, option = 'inferno'), "grey"),
                    guide = guide_legend(reverse = TRUE)) +
  theme_bw() +
  labs(x = "", y = "Proportion of Observations") +
  facet_wrap(~ season) +
  coord_flip() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold"),
        legend.text = element_text(size = 10))



## Proportion of behavior by time of night

df.TON<- dat2 %>% 
  mutate(hour1 = hour(date)) %>% 
  mutate_at('hour1', factor, levels = c(12:23,0:11)) %>% 
  group_by(hour1, z.post.thresh, .drop = F) %>% 
  tally() %>% 
  mutate(freq = n / sum(n))

ggplot(data = df.TON, aes(hour1, n, fill = z.post.thresh)) +
  annotation_raster(alpha("grey30", .5),
                    xmin = 7, xmax = 19,
                    ymin = -Inf, ymax = Inf) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_manual("", values = c(viridis(n=4, option = 'inferno'), "grey")) +
  theme_bw() +
  labs(x = "Hour", y = "Number of Observations") +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 10))

ggplot(data = df.TON, aes(hour1, freq, fill = z.post.thresh)) +
  annotation_raster(alpha("grey30", .5),
                    xmin = 7, xmax = 19,
                    ymin = -Inf, ymax = Inf) +
  geom_bar(stat = "identity",
           color = "black") +
  scale_fill_manual("", values = c(viridis(n=4, option = 'inferno'), "grey")) +
  theme_bw() +
  labs(x = "Hour", y = "Proportion of Observations") +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        legend.text = element_text(size = 10))
```


Additionally, I will be summarizing the proportion of LU/LC and the mean value of NDWI associated with each behavioral state. There does not appear to be any major differences in the proportion of land classes by behavioral state, but Closed Savanna appears to be the most prevalent across all states. Additionally, there appears to be a slight increase in the proportions of Floodable habitat visited as armadillos increase in activity and speed (i.e., from Slow-Turn to Transit behavior). The mean NDWI per sampled point shows a similar trend, where NDWI slightly increases from Slow-Turn to Transit.

```{r state_summ2, fig.width=8, fig.cap='Summaries of LU/LC and NDWI for each behavioral state.'}

## Proportion of LULC by behavioral state

df.lulc<- dat2 %>% 
  dplyr::select(z.post.thresh, Forest, Closed_Savanna, Open_Savanna, Floodable) %>% 
  pivot_longer(cols = -z.post.thresh, names_to = "lulc", values_to = "value")

df.lulc$lulc<- factor(df.lulc$lulc, levels = c("Forest", "Closed_Savanna", "Open_Savanna",
                                               "Floodable"))

ggplot(df.lulc) +
  geom_violin(aes(x = lulc, y = value, fill = lulc), alpha = 0.5) +
  scale_fill_manual(values = c("darkgreen","burlywood4","darkolivegreen3","lightskyblue1"),
                    guide = F) +
  geom_jitter(aes(lulc, value, color = lulc), alpha = 0.15, width = 0.15, height = 0.01) +
  scale_color_manual(values = c("darkgreen","burlywood4","darkolivegreen3","lightskyblue1"),
                     guide = F) +
  scale_x_discrete(labels = c("Forest", "Closed Savanna", "Open Savanna", "Floodable")) +
  theme_bw() +
  labs(x = "", y = "Proportion (w/in 30 m buffer)") +
  facet_wrap(~ z.post.thresh) +
  coord_flip() +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold"),
        legend.text = element_text(size = 10))



## NDWI by behavioral state

ggplot(dat2, aes(x = z.post.thresh, y = ndwi, fill = z.post.thresh)) +
  geom_violin(alpha = 0.5) +
  geom_jitter(aes(color = z.post.thresh), width = 0.15, height = 0, alpha = 0.15) +
  scale_fill_manual("", values = c(viridis(n=4, option = 'inferno'), "grey"),
                    guide = F) +
  scale_color_manual("", values = c(viridis(n=4, option = 'inferno'), "grey"),
                    guide = F) +
  theme_bw() +
  labs(x = "", y = "Mean NDWI (w/in 30 m buffer)") +
  theme(axis.title = element_text(size = 16),
        axis.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold"),
        legend.text = element_text(size = 10))
```


We can also take a look at the 50 and 95% kernel density isopleths for each state to get a sense of what types of land cover might be used the most during different behaviors within a spatial context. Based on a simple visual inspection of this plot, it appears that a greater amount of Floodable habitat falls within the 95% isopleth for the Transit state while the remaining states primarily overlap with Closed and Open Savanna. This corresponds with the previous figures that were shown.

```{r kde_fun}

## extract results
computeKDE = function(xy, prob=c("50%", "95%")) {
  
  kd <- kde(xy, compute.cont=TRUE)
  
  #define another function to be mapped
  get_contour = function(kd, prob) {
    contour <- with(kd, contourLines(x=eval.points[[1]], y=eval.points[[2]],
                                     z=estimate, levels=cont[prob])[[1]])
    as_tibble(contour) %>% 
      mutate(prob = prob)
  }

  dat_out <- map_dfr(prob, ~get_contour(kd, .)) %>% 
    group_by(prob) %>% 
    mutate(n_val = 1:n()) %>% 
    ungroup()

return(dat_out)
}

```


```{r kde_map, fig.width=9, fig.height=6, fig.cap='The 50 and 95 percent isopleths are shown from a kernel density estimate of locations for each state across all IDs.'}

xy.slow_turn <- subset(dat, z.post.thresh == "Slow-Turn")[, c("x", "y")]
xy.slow_unif <- subset(dat, z.post.thresh == "Slow-Unif")[, c("x", "y")]
xy.expl <- subset(dat, z.post.thresh == "Exploratory")[, c("x", "y")]
xy.transit<- subset(dat, z.post.thresh == "Transit")[, c("x", "y")]

# compute kde
kde.slow_turn <- computeKDE(xy.slow_turn, prob = c(50,95))
kde.slow_turn$state<- "Slow-Turn"
kde.slow_unif <- computeKDE(xy.slow_unif, prob = c(50,95))
kde.slow_unif$state<- "Slow-Unif"
kde.expl <- computeKDE(xy.expl, prob = c(50,95))
kde.expl$state<- "Exploratory"
kde.transit <- computeKDE(xy.transit, prob = c(50,95))
kde.transit$state<- "Transit"

kde<- rbind(kde.slow_turn, kde.slow_unif, kde.expl, kde.transit)
kde$state<- factor(kde$state, levels = c("Slow-Turn", "Slow-Unif", "Exploratory",
                                         "Transit"))

#facet of all mapped KDE by state
ggplot() +
  geom_raster(data = lulc.df, aes(x, y, fill = factor(lulc)), alpha = 0.5) +
  scale_fill_manual("", values = c("darkgreen","burlywood4","darkolivegreen3","lightskyblue1"),
                    na.value = "transparent",
                    labels = c("Forest", "Closed Savanna", "Open Savanna", "Floodable","")) +
  # geom_point(data = dat %>% 
  #              rename(state = z.post.thresh) %>% 
  #              filter(state != "Unclassified"),
  #            aes(x, y, color = id), size = 0.25, alpha = 0.75) +
  # scale_color_brewer("", palette = "Dark2") +
  geom_path(data = kde, aes(x, y, group = prob), colour = "black", size = 1) +
  labs(x = "Easting", y = "Northing") +
  theme_bw() +
  coord_equal() +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  theme(axis.title = element_text(size = 18),
        axis.text = element_text(size = 10),
        legend.text = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold")) +
  facet_wrap(~ state, ncol = 2)


```


\newpage

## Comparisons of state-habitat relationships

Multiple pairwise logistic regressions were performed to make pairwise comparisons of environmental covariates on the probability of being in one state or another. This resulted in a total of six comparisons. Since the Closed Savanna land class served as the reference for each model, estimates are only shown for the other three land classes and NDWI.

```{r}

#remove observations w/ "Unclassified" state (based on z.post.max)
dat3<- dat2 %>% 
  filter(z.post.thresh != "Unclassified")

```


### Slow-Turn vs Slow-Uniform

In this comparison, increases in the proportions of Forest, Open Savanna, or Floodable habitat were more likely to be associated with exhibiting a Slow-Turn state. While the effect of NDWI did not appear to be significant, greater values (i.e., wetter habitat) were associated with a greater probability of exhibiting a Slow-Uniform state.

```{r logres_slowturn_slowunif, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor a Slow-Uniform state.'}
## Compare Slow-Turn vs Slow-Unif (Closed Savanna and blanca are reference classes)
dat.st.su<- dat3 %>% 
  filter(z.post.thresh == "Slow-Turn" | z.post.thresh == "Slow-Unif")
dat.st.su$state<- ifelse(dat.st.su$z.post.thresh == "Slow-Turn", 0, 1)
# table(dat.st.su$id, dat.st.su$state)  #check n per combo
st.su.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                data = dat.st.su, family = binomial)
# summary(st.su.mod)

# Slow-Unif as ref
## odds ratios and 95% CI
coeffs.st.su<- data.frame(exp(cbind(fit = coef(st.su.mod), confint(st.su.mod))))
coeffs.st.su<- coeffs.st.su[2:5,]
names(coeffs.st.su)[2:3]<- c("Lower","Upper")
coeffs.st.su$coef.names<- rownames(coeffs.st.su)
coeffs.st.su$coef.names<- factor(coeffs.st.su$coef.names,
                                 levels = unique(coeffs.st.su$coef.names))

ggplot(data=coeffs.st.su, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-6,8)) +
  annotate(geom = "text", x = "Floodable", y = 4, label = "bold(Slow-Uniform)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -3, label = "bold(Slow-Turn)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())
```

\newpage

### Slow-Turn vs Exploratory

Similar to the previous comparison, increases in the proportions of Forest, Open Savanna, and Floodable habitat were more likely to be associated with exhibiting a Slow-Turn state. However, NDWI shows a positive relationship with the probability of exhibiting an Exploratory state.

```{r logres_slowturn_exploratory, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor an Exploratory state.'}
## Compare Slow-Turn vs Exploratory
dat.st.exp<- dat3 %>% 
  filter(z.post.thresh == "Slow-Turn" | z.post.thresh == "Exploratory")
dat.st.exp$state<- ifelse(dat.st.exp$z.post.thresh == "Slow-Turn", 0, 1)
# table(dat.st.exp$id, dat.st.exp$state)  #check n per combo
st.exp.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                data = dat.st.exp, family = binomial)
# summary(st.exp.mod)

# Exploratory as ref
## odds ratios and 95% CI
coeffs.st.exp<- data.frame(exp(cbind(fit = coef(st.exp.mod), confint(st.exp.mod))))
coeffs.st.exp<- coeffs.st.exp[2:5,]
names(coeffs.st.exp)[2:3]<- c("Lower","Upper")
coeffs.st.exp$coef.names<- rownames(coeffs.st.exp)
coeffs.st.exp$coef.names<- factor(coeffs.st.exp$coef.names,
                                 levels = unique(coeffs.st.exp$coef.names))

ggplot(data=coeffs.st.exp, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-6,15)) +
  annotate(geom = "text", x = "Floodable", y = 8, label = "bold(Exploratory)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -4, label = "bold(Slow-Turn)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())
```

\newpage

### Slow-Turn vs Transit

In this comparison, there was a much greater range of covariate effects with respect to the previous two comparisons. Increases in the proportion of Forest were more likely to be associated with a Slow-Turn state while Open Savanna and Floodable land classes did not show a significant effect. In this model, the effect of NDWI was much larger than when Slow-Turn was compared to Slow-Uniform and Exploratory states, indicating that NDWI is more influential in this comparison and that higher values (i.e., wetter habitat) is much more likely to be associated with a Transit state.  

```{r logres_slowturn_transit, fig.width=10, fig.height=8, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor a Transit state.'}
## Compare Slow-Turn vs Transit
dat.st.t<- dat3 %>% 
  filter(z.post.thresh == "Slow-Turn" | z.post.thresh == "Transit")
dat.st.t$state<- ifelse(dat.st.t$z.post.thresh == "Slow-Turn", 0, 1)
# table(dat.st.t$id, dat.st.t$state)  #check n per combo
st.t.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                 data = dat.st.t, family = binomial)
# summary(st.t.mod)

# Transit as ref
## odds ratios and 95% CI
coeffs.st.t<- data.frame(exp(cbind(fit = coef(st.t.mod), confint(st.t.mod))))
coeffs.st.t<- coeffs.st.t[2:5,]
names(coeffs.st.t)[2:3]<- c("Lower","Upper")
coeffs.st.t$coef.names<- rownames(coeffs.st.t)
coeffs.st.t$coef.names<- factor(coeffs.st.t$coef.names,
                                  levels = unique(coeffs.st.t$coef.names))

p.st.t<- ggplot(data=coeffs.st.t, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-100,255)) +
  annotate(geom = "text", x = "Floodable", y = 100, label = "bold(Transit)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -60, label = "bold(Slow-Turn)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())

#zoomed in
p.st.t.inset<- ggplot(data=coeffs.st.t %>% filter(coef.names != "ndwi"),
       aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  # scale_y_continuous(limits = c(-3,5)) +
  # annotate(geom = "text", x = "Open_Savanna", y = 3, label = "bold(Transit)",
  #          parse = T, size = 5) +
  # annotate(geom = "text", x = "Open_Savanna", y = -1, label = "bold(Slow-Turn)",
  #          parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable")) +
  coord_flip() +
  labs(x="", y="") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())

## create plot w/ zoomed-in inset
ggdraw() +
  draw_plot(p.st.t)  +
  draw_plot(p.st.t.inset, x = 0.48, y = 0.12, width = 0.5, height = 0.4)
```


\newpage

### Slow-Uniform vs Exploratory

In this comparison, Forest and Open Savanna did not have a significant effects, whereas Floodable habitat did show a positive relationship with the probability of exhibiting an Exploratory state. While the 95% confidence interval of NDWI overlaps 1, it appears that greater values of NDWI are more likely to occur when in an Exploratory state. This is consistent with the effect of the Floodable covariate.  

```{r logres_slowunif_exploratory, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor an Exploratory state.'}
## Compare Slow-Unif vs Exploratory
dat.su.exp<- dat3 %>% 
  filter(z.post.thresh == "Slow-Unif" | z.post.thresh == "Exploratory")
dat.su.exp$state<- ifelse(dat.su.exp$z.post.thresh == "Slow-Unif", 0, 1)
# table(dat.su.exp$id, dat.su.exp$state)  #check n per combo
su.exp.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                 data = dat.su.exp, family = binomial)
# summary(su.exp.mod)

# Exploratory as ref
## odds ratios and 95% CI
coeffs.su.exp<- data.frame(exp(cbind(fit = coef(su.exp.mod), confint(su.exp.mod))))
coeffs.su.exp<- coeffs.su.exp[2:5,]
names(coeffs.su.exp)[2:3]<- c("Lower","Upper")
coeffs.su.exp$coef.names<- rownames(coeffs.su.exp)
coeffs.su.exp$coef.names<- factor(coeffs.su.exp$coef.names,
                                  levels = unique(coeffs.su.exp$coef.names))

ggplot(data=coeffs.su.exp, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-2,6)) +
  annotate(geom = "text", x = "Floodable", y = 3.5, label = "bold(Exploratory)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -1, label = "bold(Slow-Unif)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())
```


\newpage

### Slow-Uniform vs Transit

Nearly identical to the previous comparison between the Slow-Uniform and Exploratory states, Forest and Open Savanna did not significantly effect the probability of exhibiting a Slow-Uniform or Transit state, but the Floodable land class and NDWI both displayed positive relationships with the likelihood of exhibiting a Transit state. Unlike the previous comparison, the confidence interval for NDWI doesn't cross 1.

```{r logres_slowunif_transit, fig.width=10, fig.height=8, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor a Transit state.'}
## Compare Slow-Unif vs Transit
dat.su.t<- dat3 %>% 
  filter(z.post.thresh == "Slow-Unif" | z.post.thresh == "Transit")
dat.su.t$state<- ifelse(dat.su.t$z.post.thresh == "Slow-Unif", 0, 1)
# table(dat.su.t$id, dat.su.t$state)  #check n per combo
su.t.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                 data = dat.su.t, family = binomial)
# summary(su.t.mod)

# Transit as ref
## odds ratios and 95% CI
coeffs.su.t<- data.frame(exp(cbind(fit = coef(su.t.mod), confint(su.t.mod))))
coeffs.su.t<- coeffs.su.t[2:5,]
names(coeffs.su.t)[2:3]<- c("Lower","Upper")
coeffs.su.t$coef.names<- rownames(coeffs.su.t)
coeffs.su.t$coef.names<- factor(coeffs.su.t$coef.names,
                                  levels = unique(coeffs.su.t$coef.names))

p.su.t<- ggplot(data=coeffs.su.t, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-40,85), breaks = seq(-25,75, by=25)) +
  annotate(geom = "text", x = "Floodable", y = 40, label = "bold(Transit)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -20, label = "bold(Slow-Unif)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())



#zoomed in
p.su.t.inset<- ggplot(data=coeffs.su.t %>% filter(coef.names != "ndwi"),
       aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  # scale_y_continuous(limits = c(-2,5)) +
  # annotate(geom = "text", x = "Open_Savanna", y = 3.5, label = "bold(Transit)",
  #          parse = T, size = 5) +
  # annotate(geom = "text", x = "Open_Savanna", y = -1, label = "bold(Slow-Unif)",
  #          parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable")) +
  coord_flip() +
  labs(x="", y="") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())

## create plot w/ zoomed-in inset
ggdraw() +
  draw_plot(p.su.t)  +
  draw_plot(p.su.t.inset, x = 0.48, y = 0.12, width = 0.5, height = 0.4)
```


\newpage

### Exploratory vs Transit

Similar to the previous two comparisons, Forest and Open Savanna did not significantly effect the probability of exhibiting an Exploratory or Transit state, but the Floodable land class and NDWI both displayed positive relationships with the likelihood of exhibiting a Transit state. However, it should be noted that the 95% confidence interval for NDWI does cross 1 in this comparison. 

```{r logres_exploratory_transit, fig.cap='Odds ratios for each of the environmental covariates where values greater than 1 favor a Transit state.'}
## Compare Exploratory vs Transit
dat.exp.t<- dat3 %>% 
  filter(z.post.thresh == "Exploratory" | z.post.thresh == "Transit")
dat.exp.t$state<- ifelse(dat.exp.t$z.post.thresh == "Exploratory", 0, 1)
# table(dat.exp.t$id, dat.exp.t$state)  #check n per combo
exp.t.mod<- glm(state ~ Forest + Open_Savanna + Floodable + ndwi + id,
                 data = dat.exp.t, family = binomial)
# summary(exp.t.mod)

# Transit as ref
## odds ratios and 95% CI
coeffs.exp.t<- data.frame(exp(cbind(fit = coef(exp.t.mod), confint(exp.t.mod))))
coeffs.exp.t<- coeffs.exp.t[2:5,]
names(coeffs.exp.t)[2:3]<- c("Lower","Upper")
coeffs.exp.t$coef.names<- rownames(coeffs.exp.t)
coeffs.exp.t$coef.names<- factor(coeffs.exp.t$coef.names,
                                  levels = unique(coeffs.exp.t$coef.names))

ggplot(data=coeffs.exp.t, aes(x=coef.names, y=fit, ymin=Lower, ymax=Upper)) +
  geom_hline(yintercept = 1) +
  geom_errorbar(position = position_dodge(0.55), width = 0, size = 0.75) +
  geom_point(position = position_dodge(0.55), size=2) +
  scale_y_continuous(limits = c(-10,22)) +
  annotate(geom = "text", x = "Floodable", y = 12, label = "bold(Transit)",
           parse = T, size = 5) +
  annotate(geom = "text", x = "Floodable", y = -5, label = "bold(Exploratory)",
           parse = T, size = 5) +
  theme_bw() +
  scale_x_discrete(labels = c("Forest","Open Savanna","Floodable","NDWI")) +
  coord_flip() +
  labs(x="", y="Odds Ratio") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        panel.grid = element_blank())

```


\newpage


# Discussion

Based on our analysis that used a non-parametric Bayesian mixture model to estimate the number of optimal states and their distributions for each data stream (i.e., activity counts, speed, turning angles), four *active* states appeared optimal for these data. Two states had relatively low activity counts and low speed, but differed in their distributions of turning angles. The state with turning angles near $-\pi/\pi$ radians was labeled "Slow-Turn" while the other had a uniform distribution of turning angles and was labeled "Slow-Uniform". These state names primarily serve as a place-holder for more descriptive labels. The third state had a higher level of activity counts and higher speeds with turning angles slightly concentrated around 0 radians, although only slightly. This state was labeled "Exploratory" and may represent an intermediate activity state while armadillos are searching for food, shelter, or conspecifics. The fourth state displayed the greatest activity counts, highest speeds, and turning angles highly concentrated near 0 radians. These states were then assigned to the 62% of observations where certainty of belonging to a single state was high ($\geq$ 75%). When there was greater uncertainty as to which state an observation belonged, it was labeled as "Unclassified". These state estimates were used in the subsequent analyses that compared the effects of LU/LC and NDWI on exhibiting one state over another.\newline


When evaluating general trends in the proportions of behavioral states, there was little variation in the frequency of the states that were exhibited across individuals, seasons, and by hour of the day. In general, the "Exploratory" and "Slow-Uniform" states were most common, followed by "Slow-Turn" and then "Transit". This seems to make sense given that the "Exploratory" state may be related to searching for sites to forage, whereas "Transit" would typically occur when moving quickly over long distances between patches of habitat. It is currently unclear what behaviors are represented by the slower behavioral states. Additionally, relationships with environmental covariates did not appear to be easily discernible.\newline


When assessing the effects of environmental covariates on the probability of exhibiting one state over another, there was typically a consistent pattern when moving from slow to fast states. In each of the logistic regressions, the slower state was often favored when there were greater proportions of Forest and Open Savanna, whereas the faster state was favored with higher values of NDWI. The Floodable land class showed mixed responses, but is more closely associated with the effect of NDWI since it reflects a very similar landscape metric.\newline


While there do appear to be potential ecological patterns that emerge from comparisons among states, it is currently difficult to discriminate among states for the given set of data and analyses. It is possible that not enough behavioral variation was captured by these specific tracks since there were not distinct values of environmental covariates that characterized each of the different states. However, further analyses with a larger sample size may be able to discriminate these behaviors further. Additionally, these states may be used for additional analyses, such as to assess habitat selection for specific behavioral states.